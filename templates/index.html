<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="{{ url_for('static',filename='css/index.css') }}">
  <script type="text/javascript" src="{{ url_for('static',filename='js/index.js')}}"></script>
  <title>CitiBike Visualization</title>
</head>
<body>

  <div id="container-logo">
      <img src="{{url_for('static', filename='logo.png')}}" alt="logo">
  </div>

  <div>
    <br>
  </div>

  <div>
    <style>
      svg {
          border: 1px solid #000000;
      }
      rect {
          stroke: SteelBlue;
          stroke-width: 2;
          fill: LightSteelBlue  ;
      }
  
      rect:hover {
          fill: SteelBlue ;
      }
  
      .eje text{
          font: 10px sans-serif;
      }
  
      .eje path, .eje line {
          fill: none;
          stroke: #000;
          shape-rendering: crispEdges;
      }
  
      .tooltip {
          font-family: Arial, helvetica, sans-serif;
          font-size: 10px;
          padding: 8px;
          background: rgba(0, 0, 0, 0.7);
          border: 1px solid #FFFFFF;
          box-shadow: rgba(0, 0, 0, 0.5) 1px 1px 4px;
          color: #FFFFFF;
          border-radius: 4px;
      }
      .axis text{
        font: 15px Arial;
        font-weight: bold;
      }
  </style>
  <svg></svg>
  <script src="http://d3js.org/d3.v3.min.js"></script>
  <script src="{{ url_for('static',filename='js/d3-tip.js')}}" type="text/javascript"></script>
  
  <script>
    var config = { columnWidth: 20, columnHeight: 235, columnGap: 5, padding: 100};
    
    d3.json("{{ url_for('static', filename='/data/NumberOfTripsByHour.json ') }}", function(error, json) {
    if (error) {
        return console.warn(error);
    }
    renderBarPlot(json);
    });
 
function renderBarPlot(datos){

    var title = "Numero de viajes por hora"
    var xLabelTitle = "Horas del dia"
    var yLabelTitle = "Cantidad de viajes"

  var NUM_COLUMNAS = datos.length;
        config.width = NUM_COLUMNAS * (config.columnWidth + config.columnGap) + (2 * config.padding);
        config.height = config.columnHeight + 2 * config.padding;

        var TRIPS_AMOUNT = d3.max(datos, function(d) { return d.number_of_trips; });

        var x = d3.scale.ordinal()
            .rangeRoundBands([0, config.width - 2 * config.padding])
            .domain(datos.map(function(d) { return d.time; }));

        var y = d3.scale.linear()
            .range([0, config.columnHeight])
            .domain([0, TRIPS_AMOUNT]);

        var rangeY = d3.scale.linear()
            .range([config.columnHeight, 0])
            .domain([0, TRIPS_AMOUNT]);


        var ejeX = d3.svg.axis()
            .scale(x)
            .orient("bottom");

        var ejeY = d3.svg.axis()
            .scale(rangeY)
            .orient("left");

        var tooltip = d3.tip()
            .attr('class', 'tooltip')
            .offset([-10, 0])
            .html(function(d) {
                return "<strong> Tiempo: " + d.time + "</strong><br> Numero de viajes: " +d.number_of_trips;
            });

        var svg = d3.select("svg")
            .attr("width", config.width)
            .attr("height", config.height);

        svg.call(tooltip);

        svg.append("g")
            .attr("class", "eje")
            .attr("transform", "translate(" + config.padding + "," + (10 + config.padding + config.columnHeight) + ")")
            .call(ejeX)
          .selectAll("text")
            .attr("transform", "rotate(90)")
            .attr("x", "10")
            .attr("y", "-3")
            .style("text-anchor", "start");

        svg.append("g")
            .attr("class", "eje")
            .attr("transform", "translate(" + (config.padding - 10) + "," + config.padding + ")")
            .call(ejeY);

        svg.append("text")
            .attr("class", "axis")
            .attr("text-anchor", "middle")
            .attr("x", config.width/2)
            .attr("y", 32)
            .text(title);

        svg.append("text")
            .attr("class", "axis")
            .attr("text-anchor", "middle")
            .attr("x", config.width/2)
            .attr("y", config.height - 10)
            .text(xLabelTitle);

        svg.append("text")
            .attr("class", "axis")
            .attr("text-anchor", "middle")
            .attr("x", -config.height/2)
            .attr("y", 16)
            .attr("transform", "rotate(-90)")
            .text(yLabelTitle);

        svg.selectAll("rect")
            .data(datos)
            .enter().append("rect")
            .attr("width", config.columnWidth)
            .attr("x", function(d,i) { return config.padding + x(d.time) })
            .attr("y", function(d,i) { return config.padding + config.columnHeight - y(d.number_of_trips) })
            .attr("height", function(d,i) { return y(d.number_of_trips) })
            .attr("data-time", function(d,i) { return d.time })
            .attr("data-number_of_trips", function(d,i) { return  (+d.number_of_trips) })
            .on('mouseover', tooltip.show)
            .on('mouseout', tooltip.hide)
}
  </script>
  </div>
</body>
</html>